(()=>{"use strict";var e,t,n={20(e,t,n){var o=n(609),r=Symbol.for("react.element"),a=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),i=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,n){var o,c={},d=null,s=null;for(o in void 0!==n&&(d=""+n),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(s=t.ref),t)a.call(t,o)&&!l.hasOwnProperty(o)&&(c[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===c[o]&&(c[o]=t[o]);return{$$typeof:r,type:e,key:d,ref:s,props:c,_owner:i.current}}},87(e){e.exports=window.wp.element},609(e){e.exports=window.React},848(e,t,n){e.exports=n(20)}},o={};function r(e){var t=o[e];if(void 0!==t)return t.exports;var a=o[e]={exports:{}};return n[e](a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(n,o){if(1&o&&(n=this(n)),8&o)return n;if("object"==typeof n&&n){if(4&o&&n.__esModule)return n;if(16&o&&"function"==typeof n.then)return n}var a=Object.create(null);r.r(a);var i={};e=e||[null,t({}),t([]),t(t)];for(var l=2&o&&n;("object"==typeof l||"function"==typeof l)&&!~e.indexOf(l);l=t(l))Object.getOwnPropertyNames(l).forEach(e=>i[e]=()=>n[e]);return i.default=()=>n,r.d(a,i),a},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a=r(609),i=r(87);const l=window.wp.blockLibrary,c=window.wp.components,d=window.wp.primitives;var s=r(848),u=(0,s.jsx)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,s.jsx)(d.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})});function y({onClick:e}){return(0,a.createElement)(c.Button,{className:"anybody-editing-edit-button",icon:u,label:"Edit this block",onClick:e,variant:"primary",size:"small"})}const m=window.wp.blockEditor,p=window.wp.blocks,f=window.wp.apiFetch;var b=r.n(f);const{postId:v}=window.anybodyEditingData;function w({blockIndex:e,onSave:t,onCancel:n}){const[o,r]=(0,i.useState)(!1),[l,d]=(0,i.useState)(null),s=window.anybodyEditingData.post.content,u=(0,i.useMemo)(()=>(0,p.parse)(s),[s]),[y,f]=(0,i.useState)(()=>{const t=u.filter(e=>e.name);return t[e]?[t[e]]:[]});return(0,a.createElement)("div",{className:"anybody-editing-editor-wrapper"},(0,a.createElement)(m.BlockEditorProvider,{value:y,onInput:e=>f(e),onChange:e=>f(e)},(0,a.createElement)(m.WritingFlow,null,(0,a.createElement)(m.ObserveTyping,null,(0,a.createElement)(m.BlockList,null))),(0,a.createElement)(c.Popover.Slot,null)),l&&(0,a.createElement)("div",{className:"anybody-editing-error"},l),(0,a.createElement)("div",{className:"anybody-editing-editor-actions"},(0,a.createElement)(c.Button,{variant:"tertiary",onClick:n,disabled:o},"Cancel"),(0,a.createElement)(c.Button,{variant:"primary",onClick:async()=>{r(!0),d(null);try{const n=u.filter(e=>e.name);n[e]=y[0];const o=[];let r=0;for(const e of u)e.name?(o.push(n[r]),r++):o.push(e);const a=(0,p.serialize)(o);await async function(e){return b()({path:`anybody-editing/v1/posts/${v}`,method:"POST",data:e})}({content:a}),t()}catch(e){d(e.message||"Failed to save. Please try again."),r(!1)}},disabled:o},o?(0,a.createElement)(c.Spinner,null):"Save")))}function E(){const[e,t]=(0,i.useState)(null),[n,o]=(0,i.useState)([]);return(0,i.useEffect)(()=>{const e=document.querySelectorAll(".anybody-editing-block"),t=Array.from(e).map((e,t)=>({element:e,index:t,name:e.dataset.blockName}));o(t),t.forEach(e=>{const t=document.createElement("div");t.className="anybody-editing-button-container",e.element.appendChild(t)})},[]),(0,i.useEffect)(()=>{n.forEach(n=>{const o=n.element.querySelector(".anybody-editing-button-container");o&&e!==n.index&&Promise.resolve().then(r.t.bind(r,87,23)).then(({render:e})=>{e((0,a.createElement)(y,{onClick:()=>t(n.index)}),o)})})},[n,e]),(0,i.useEffect)(()=>{if(null===e)return;const o=n[e];if(!o)return;let i=o.element.querySelector(".anybody-editing-editor-container");return i||(i=document.createElement("div"),i.className="anybody-editing-editor-container",o.element.appendChild(i)),Promise.resolve().then(r.t.bind(r,87,23)).then(({render:n})=>{n((0,a.createElement)(w,{blockIndex:e,onSave:()=>{t(null),window.location.reload()},onCancel:()=>t(null)}),i)}),()=>{i&&(i.innerHTML="")}},[e,n]),null}function g(){(0,l.registerCoreBlocks)();const e=document.createElement("div");e.id="anybody-editing-root",document.body.appendChild(e),(0,i.render)((0,a.createElement)(E,null),e)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g()})();